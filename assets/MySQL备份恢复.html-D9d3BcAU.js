import{_ as t}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as h,c as k,b as i,e as l,w as n,a as p,o as d,d as e}from"./app-CPE2FVww.js";const r="/images/MySQL_binlog.png",g={},c={class:"table-of-contents"};function o(A,s){const a=h("router-link");return d(),k("div",null,[s[17]||(s[17]=i("h1",{id:"mysql备份恢复",tabindex:"-1"},[i("a",{class:"header-anchor",href:"#mysql备份恢复"},[i("span",null,"MySQL备份恢复")])],-1)),i("nav",c,[i("ul",null,[i("li",null,[l(a,{to:"#flag"},{default:n(()=>s[0]||(s[0]=[e("Flag")])),_:1})]),i("li",null,[l(a,{to:"#binlog2sql"},{default:n(()=>s[1]||(s[1]=[e("binlog2sql")])),_:1}),i("ul",null,[i("li",null,[l(a,{to:"#mysql必须设置参数"},{default:n(()=>s[2]||(s[2]=[e("MySQL必须设置参数")])),_:1})]),i("li",null,[l(a,{to:"#user需要的最小权限集合"},{default:n(()=>s[3]||(s[3]=[e("user需要的最小权限集合")])),_:1})]),i("li",null,[l(a,{to:"#查看目前的binlog文件"},{default:n(()=>s[4]||(s[4]=[e("查看目前的binlog文件")])),_:1})]),i("li",null,[l(a,{to:"#定位误操作sql的binlog位置"},{default:n(()=>s[5]||(s[5]=[e("定位误操作SQL的binlog位置")])),_:1})]),i("li",null,[l(a,{to:"#生成sql文件回滚"},{default:n(()=>s[6]||(s[6]=[e("生成sql文件回滚")])),_:1})]),i("li",null,[l(a,{to:"#不生成sql文件回滚"},{default:n(()=>s[7]||(s[7]=[e("不生成sql文件回滚")])),_:1})])])]),i("li",null,[l(a,{to:"#mysqldump"},{default:n(()=>s[8]||(s[8]=[e("mysqldump")])),_:1}),i("ul",null,[i("li",null,[l(a,{to:"#mysqldump导出"},{default:n(()=>s[9]||(s[9]=[e("mysqldump导出")])),_:1})]),i("li",null,[l(a,{to:"#mysqldump导入"},{default:n(()=>s[10]||(s[10]=[e("mysqldump导入")])),_:1})]),i("li",null,[l(a,{to:"#mysqldump两台主机同步"},{default:n(()=>s[11]||(s[11]=[e("mysqldump两台主机同步")])),_:1})])])]),i("li",null,[l(a,{to:"#source命令导入"},{default:n(()=>s[12]||(s[12]=[e("source命令导入")])),_:1})]),i("li",null,[l(a,{to:"#主从同步"},{default:n(()=>s[13]||(s[13]=[e("主从同步")])),_:1}),i("ul",null,[i("li",null,[l(a,{to:"#配置主服务器"},{default:n(()=>s[14]||(s[14]=[e("配置主服务器")])),_:1})]),i("li",null,[l(a,{to:"#配置从服务器"},{default:n(()=>s[15]||(s[15]=[e("配置从服务器")])),_:1})]),i("li",null,[l(a,{to:"#如果出现以下错误"},{default:n(()=>s[16]||(s[16]=[e("如果出现以下错误")])),_:1})])])])])]),s[18]||(s[18]=p(`<h2 id="flag" tabindex="-1"><a class="header-anchor" href="#flag"><span>Flag</span></a></h2><ul><li>热备份 <a href="https://github.com/percona/percona-xtrabackup" target="_blank" rel="noopener noreferrer">https://github.com/percona/percona-xtrabackup</a></li><li><a href="https://github.com/blylei/frabit" target="_blank" rel="noopener noreferrer">https://github.com/blylei/frabit</a></li></ul><h2 id="binlog2sql" tabindex="-1"><a class="header-anchor" href="#binlog2sql"><span>binlog2sql</span></a></h2><ul><li><a href="https://dev.mysql.com/doc/refman/8.0/en/mysqlbinlog.html" target="_blank" rel="noopener noreferrer">https://dev.mysql.com/doc/refman/8.0/en/mysqlbinlog.html</a></li></ul><blockquote><p>使用此方式之前一定是MySQL开启了bin-log的才可行，如果没有安装开源工具<code>binlog2sql</code>那么请安装。</p><p>binlog2sql是一款简单易用的binlog解析工具，其中一个功能就是生成回滚SQL。</p></blockquote><ul><li><a href="https://github.com/danfengcao/binlog2sql" target="_blank" rel="noopener noreferrer">https://github.com/danfengcao/binlog2sql</a></li><li><a href="https://github.com/Michaelsky0913/binlog2sql" target="_blank" rel="noopener noreferrer">https://github.com/Michaelsky0913/binlog2sql</a></li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> clone</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> https://github.com/danfengcao/binlog2sql.git</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> binlog2sql/</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">pip</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -r</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> requirements.txt</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="mysql必须设置参数" tabindex="-1"><a class="header-anchor" href="#mysql必须设置参数"><span>MySQL必须设置参数</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[mysqld]</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">server_id</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log_bin</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /var/log/mysql/mysql-bin.log</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">max_binlog_size</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 1G</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">binlog_format</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> row</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">binlog_row_image</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> full</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="user需要的最小权限集合" tabindex="-1"><a class="header-anchor" href="#user需要的最小权限集合"><span>user需要的最小权限集合</span></a></h3><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">select</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, super/replication client, replication slave</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">-- 建议授权</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">GRANT</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, REPLICATION SLAVE, REPLICATION CLIENT </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> *.* </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">TO</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="查看目前的binlog文件" tabindex="-1"><a class="header-anchor" href="#查看目前的binlog文件"><span>查看目前的binlog文件</span></a></h3><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">show </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">master</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> logs;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>查询结果</li></ul><table><thead><tr><th>Log_name</th><th>File_size</th></tr></thead><tbody><tr><td>mysql-bin.000001</td><td>177</td></tr><tr><td>mysql-bin.000002</td><td>437</td></tr><tr><td>mysql-bin.000003</td><td>685</td></tr><tr><td>mysql-bin.000004</td><td>1702399</td></tr><tr><td>mysql-bin.000005</td><td>963964</td></tr><tr><td>mysql-bin.000006</td><td>13118637</td></tr><tr><td>mysql-bin.000007</td><td>26765043</td></tr></tbody></table><h3 id="定位误操作sql的binlog位置" tabindex="-1"><a class="header-anchor" href="#定位误操作sql的binlog位置"><span>定位误操作SQL的binlog位置</span></a></h3><blockquote><p>可以看到最新的binlog文件是mysql-bin.000007，我们再定位误操作SQL的binlog位置</p></blockquote><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># \`binlog2sql.py\`文件在\`binlog2sql/binlog2sql/\`文件夹下</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 如果命令最后不加时间可输出最近操作的SQL命令</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">python</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> binlog2sql/binlog2sql.py</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -h127.0.0.1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -P端口</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -u账号</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;密码&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    -d数据库</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -t表</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --start-file=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;binlog文件&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    --start-datetime=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;之前误操作的SQL执行开始时间&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    --stop-datetime=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;之前误操作的SQL执行结束时间&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>当程序跑完之后看最后一条数据最末尾：<code>#start 5117865 end 13679060 time 2018-06-12 10:07:53</code> 开始位置（start 5117865）和结束位置（end 13679060）</p></blockquote><p><img src="`+r+`" alt=""></p><h3 id="生成sql文件回滚" tabindex="-1"><a class="header-anchor" href="#生成sql文件回滚"><span>生成sql文件回滚</span></a></h3><blockquote><p>生成<code>rollback.sql</code>文件，并检查回滚SQL是否正确</p></blockquote><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">python</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> binlog2sql/binlog2sql.py</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -h127.0.0.1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -P端口</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -u账号</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;密码&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    -d数据库</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -t表</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --start-file=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;binlog文件&#39;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --start-position=开始位置</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    --stop-position=结束位置</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -B</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">rollback.sql</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>查看当前文件夹下是否生成了rollback.sql文件,确认回滚SQL正确，如果有就执行回滚</p></blockquote><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mysql</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -h127.0.0.1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -P端口</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -u账号</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;密码&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">rollback.sql</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="不生成sql文件回滚" tabindex="-1"><a class="header-anchor" href="#不生成sql文件回滚"><span>不生成sql文件回滚</span></a></h3><blockquote><p>不生成rollback.sql文件，执行命令后在输出中检查回滚SQL是否正确</p></blockquote><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">python</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> binlog2sql/binlog2sql.py</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -h127.0.0.1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -P端口</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -u账号</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;密码&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    -d数据库</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -t表</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --start-file=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;binlog文件&#39;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --start-position=开始位置</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    --stop-position=结束位置</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -B</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>确认回滚SQL正确，执行回滚语句。登录MySQL确认，数据回滚成功。</p></blockquote><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">python</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> binlog2sql/binlog2sql.py</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -h127.0.0.1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -P端口</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -u账号</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;密码&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    -d数据库</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -t表</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --start-file=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;binlog文件&#39;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --start-position=开始位置</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    --stop-position=结束位置</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -B</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mysql</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -h127.0.0.1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -P端口</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -u账号</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;密码&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="mysqldump" tabindex="-1"><a class="header-anchor" href="#mysqldump"><span>mysqldump</span></a></h2><ul><li><a href="https://dev.mysql.com/doc/refman/8.0/en/mysqldump.html" target="_blank" rel="noopener noreferrer">https://dev.mysql.com/doc/refman/8.0/en/mysqldump.html</a></li></ul><blockquote><p>如果是在本机上备份本机的数据库地址和端口可以不要，如果是在本机上备份其他主机上的数据库就需要地址和端口</p></blockquote><ul><li><a href="/files/MySQL%E5%A4%87%E4%BB%BD%E5%B9%B6%E5%88%A0%E9%99%A4%E5%8E%86%E5%8F%B2.sh">MySQL备份并删除历史.sh</a></li><li><a href="/files/MySQL%E5%90%8C%E6%AD%A5%E8%BF%9C%E7%A8%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%B0%E6%9C%AC%E5%9C%B0.sh">MySQL同步远程数据库到本地.sh</a></li></ul><blockquote><p><code>mysqldump</code>命令需要手动输入密码，所以一般不输入<code>-p</code>参数</p></blockquote><ul><li><a href="https://blog.csdn.net/hao7030187/article/details/77839968" target="_blank" rel="noopener noreferrer">mysqldump数据导出参数说明</a></li><li><a href="http://www.cnblogs.com/chenmh/p/5300370.html" target="_blank" rel="noopener noreferrer">mysqldump数据导出参数说明</a></li></ul><p><strong>参数说明</strong></p><ul><li><code>-d</code> 结构(--no-data:不导出任何数据，只导出数据库表结构)</li><li><code>-t</code> 数据(--no-create-info:只导出数据，而不添加CREATE TABLE 语句)</li><li><code>-n</code> (--no-create-db:只导出数据，而不添加CREATE DATABASE 语句）</li><li><code>-R</code> (--routines:导出存储过程以及自定义函数)</li><li><code>-E</code> (--events:导出事件)</li><li><code>--triggers</code> (默认导出触发器，使用--skip-triggers屏蔽导出)</li><li><code>-B</code> (--databases:导出数据库列表，单个库时可省略）</li><li><code>--tables</code> 表列表（单个表时可省略） <ul><li>①同时导出结构以及数据时可同时省略-d和-t</li><li>②同时不导出结构和数据可使用-ntd</li><li>③只导出存储过程和函数可使用-R -ntd</li><li>④导出所有(结构&amp;数据&amp;存储过程&amp;函数&amp;事件&amp;触发器)使用-R -E(相当于①，省略了-d -t;触发器默认导出)</li><li>⑤只导出结构&amp;函数&amp;事件&amp;触发器使用 -R -E -d</li></ul></li><li><code>--opt</code>等同于以下参数，该选项默认开启， 可以用--skip-opt禁用 <ul><li><code>--add-drop-table</code></li><li><code>--add-locks</code></li><li><code>--create-options</code></li><li><code>--quick</code></li><li><code>--extended-insert</code></li><li><code>--lock-tables</code></li><li><code>--skip-set-charset</code></li><li><code>--disable-keys</code></li><li><code>--default-character-set=utf8</code></li><li><code>--hex-blob</code> 使用十六进制符号转储二进制字符串列</li><li><code>--single-transaction</code></li><li><code>--flush-logs</code></li><li><code>--compress</code></li></ul></li></ul><ol><li>--opt 在创建表结构之前 会有 DROP TABLE IF EXISTS</li><li>原表在创建的时候指定了AUTO_INCREMENT，在使用了--opt 仍然和建表时候一样存在参数，在使用参数--skip-opt的时候，忽略了此参数AUTO_INCREMENT</li><li>在使用参数--opt的时候，创建表的类型，字符集等等都是默认参数ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8;当使用了--skip-opt的时候，这些参数都给忽略了</li><li>导出原表中的数据，--opt是一个insert多个value，在使用了--skip-opt的时候，是多个insert组成的；</li></ol><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">-- 查看字符编码的系统变量</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">show variables </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">like</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;%char%&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">-- 设置默认的字符集为utf8</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">set</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> character_set_database</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">utf8;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="mysqldump导出" tabindex="-1"><a class="header-anchor" href="#mysqldump导出"><span>mysqldump导出</span></a></h3><ul><li><a href="https://stackoverflow.com/questions/44015692/access-denied-you-need-at-least-one-of-the-super-privileges-for-this-operat" target="_blank" rel="noopener noreferrer">Access denied; you need (at least one of) the SUPER privilege(s) for this operation</a></li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 只导出结构&amp;函数&amp;事件&amp;触发器使用</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mysqldump</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -R</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -E</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -h需要备份的主机地址</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -P端口</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -u用户名</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 数据库名</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --default-character-set=utf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">8&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /home/backup.sql</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 只导出存储过程和函数可使用</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mysqldump</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -R</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -ntd</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -h需要备份的主机地址</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -P端口</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -u用户名</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 数据库名</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --default-character-set=utf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">8&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /home/backup.sql</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 导出单个数据库中所有(结构&amp;数据&amp;存储过程&amp;函数&amp;事件&amp;触发器)到sql文件</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mysqldump</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -R</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -E</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -h需要备份的主机地址</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -P端口</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -u用户名</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 数据库名</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --default-character-set=utf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">8&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /home/backup.sql</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># mysqldump 备份并压缩sql文件</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mysqldump</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -R</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -E</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -h主机地址</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -P端口</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -u用户名</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 数据库名</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --default-character-set=utf8</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">gzip</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/home/backup.sql.gz</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 备份所有的数据库到一个sql文件</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mysqldump</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -R</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -E</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -h主机地址</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -P端口</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -u用户名</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --all-databases</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --default-character-set=utf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">8&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /home/all.sql</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 从一个数据库导出到另一个数据库</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mysqldump</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -R</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -E</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -u用户名</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 数据库名</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mysql</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 新数据库名</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -u用户名</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p密码</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>如果提示如下错误，执行<code>vi /etc/my.cnf</code></li></ul><blockquote><p><code>mysqldump: [Warning] Using a password on the command line interface can be insecure</code></p></blockquote><div class="language-ini line-numbers-mode" data-highlighter="shiki" data-ext="ini" data-title="ini" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># [mysqldump]</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">[client]</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 查看mysql.scok位置 netstat -ln | grep mysql</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#socket = /tmp/mysql.scok</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">default-character-set</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> utf8mb4</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">host</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> 127.0.0.1</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">user</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> root</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">password</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;123&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 导出</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mysqldump</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --defaults-extra-file=/etc/my.cnf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 新数据库名</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">database.sql</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 导入</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mysql</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --defaults-extra-file=/etc/my.cnf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 新数据库名</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">database.sql</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-batch line-numbers-mode" data-highlighter="shiki" data-ext="batch" data-title="batch" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">echo</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> off</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">:: 存储sql脚本文件的目录</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">set</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dirPath</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">D:\\mysql_backup&quot;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">:: 数据库名</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">set</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">databaseName</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">demo&quot;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">:: 设置时间变量</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">set</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Ymd</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#E06C75;">%</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">date</span><span style="--shiki-light:#50A14F;--shiki-dark:#E06C75;">:~</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#50A14F;--shiki-dark:#E06C75;">,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">4</span><span style="--shiki-light:#50A14F;--shiki-dark:#E06C75;">%%</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">date</span><span style="--shiki-light:#50A14F;--shiki-dark:#E06C75;">:~</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">5</span><span style="--shiki-light:#50A14F;--shiki-dark:#E06C75;">,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#50A14F;--shiki-dark:#E06C75;">%%</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">date</span><span style="--shiki-light:#50A14F;--shiki-dark:#E06C75;">:~</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8</span><span style="--shiki-light:#50A14F;--shiki-dark:#E06C75;">,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#50A14F;--shiki-dark:#E06C75;">%</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">:: 创建存储的文件夹</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> not</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> exist</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> %dirPath%</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> md</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> %dirPath%</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">:: 执行备份操作</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">mysqldump --opt --user=root --password=root --host=127.0.0.1 --protocol=tcp </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">^</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    --port=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3306</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> --default-character-set=utf8 --single-transaction=TRUE </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">^</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    --routines --events </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">%databaseName%</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt;D:\\mysql_backup\\backup_demo_</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">%Ymd%</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.sql</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">:: 从文件夹或树中选择要进行批处理的文件，删除两周前的备份数据</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">forfiles</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /p </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">%dirPath%</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /m backup_*.sql -d </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">-14</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /c </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;cmd /c del /f @path&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Windows导出，Linux导入编码问题</strong></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mysqldump</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> db</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> –default-character-set=latin1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -r</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> utf8.dump</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 把里面的 CHARSET=latin1 替换为 CHARSET=utf8，删掉其中的 SET NAMES latin1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sed</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -e</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> s,CHARSET=latin1,CHARSET=utf8,g</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">utf8.dump</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">utf8.dump.edited</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 导入</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mysql</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -uroot</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --default-character-set=utf8</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> db</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">-- 设置数据库编码</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> names utf8;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">SOURCE </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">utf8</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">dump</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.edited;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="mysqldump导入" tabindex="-1"><a class="header-anchor" href="#mysqldump导入"><span>mysqldump导入</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 用mysqldump导入本地sql文件</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mysqldump</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -h主机地址</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -P端口</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -u用户名</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 数据库名</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/home/backup.sql</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># mysql直接用压缩文件恢复</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">gunzip</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">backup.sql.gz</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mysql</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -h主机地址</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -P端口</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -u用户名</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p密码</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 数据库名</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># mysql从本地sql文件导入</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mysql</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -h主机地址</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -P端口</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -u用户名</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p密码</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 数据库名</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">backupfile.sql</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="mysqldump两台主机同步" tabindex="-1"><a class="header-anchor" href="#mysqldump两台主机同步"><span>mysqldump两台主机同步</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mysqldump</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -R</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -E</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -h导出的主机地址</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -P端口</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -u用户名</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 数据库名</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mysql</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -h导入的主机地址</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -P端口</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -u用户名</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p密码</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -C</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 数据库名</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="source命令导入" tabindex="-1"><a class="header-anchor" href="#source命令导入"><span>source命令导入</span></a></h2><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 进入MySQL并指定数据库</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">use</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 数据库名</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 导入数据（注意sql文件的路径）</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">source</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /home/backup.sql</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="主从同步" tabindex="-1"><a class="header-anchor" href="#主从同步"><span>主从同步</span></a></h2><h3 id="配置主服务器" tabindex="-1"><a class="header-anchor" href="#配置主服务器"><span>配置主服务器</span></a></h3><p><strong>在[mysqld]节点下按需添加</strong></p><div class="language-conf line-numbers-mode" data-highlighter="shiki" data-ext="conf" data-title="conf" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>[mysqld]</span></span>
<span class="line"><span># 设置server_id，一般设置为IP,注意要唯一</span></span>
<span class="line"><span>server_id=100</span></span>
<span class="line"><span># 复制过滤：也就是指定数据库不用同步,多个之间用&#39;,&#39;号分割</span></span>
<span class="line"><span>binlog-ignore-db=mysql,information_schema,preformance_schema</span></span>
<span class="line"><span># 指定需要同步的二进制数据库</span></span>
<span class="line"><span>binlog-do-db=test</span></span>
<span class="line"><span># 开启二进制日志功能，可以随便取，最好有含义（关键就是这里了）</span></span>
<span class="line"><span>log-bin=edu-mysql-bin</span></span>
<span class="line"><span># 为每个session 分配的内存，在事务过程中用来存储二进制日志的缓存</span></span>
<span class="line"><span>binlog_cache_size=1M</span></span>
<span class="line"><span># 主从复制的格式（mixed,statement,row，默认格式是statement）</span></span>
<span class="line"><span>binlog_format=mixed</span></span>
<span class="line"><span># 二进制日志自动删除/过期的天数。默认值为0，表示不自动删除。</span></span>
<span class="line"><span>expire_logs_days=5</span></span>
<span class="line"><span># 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。</span></span>
<span class="line"><span># 如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致</span></span>
<span class="line"><span>slave_skip_errors=1062</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>创建数据同步用户</strong></p><blockquote><p>这里主要是要授予用户REPLICATION SLAVE权限和REPLICATION CLIENT权限</p></blockquote><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> USER</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IF</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> NOT</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> EXISTS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;slave&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;%&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> IDENTIFIED </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">BY</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;密码&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">GRANT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> REPLICATION SLAVE, REPLICATION CLIENT </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> *.* </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">TO</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;slave&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;%&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">FLUSH PRIVILEGES;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="配置从服务器" tabindex="-1"><a class="header-anchor" href="#配置从服务器"><span>配置从服务器</span></a></h3><p><strong>在[mysqld]节点下按需添加</strong></p><blockquote><p>从库中的<code>server-id</code>值一定不要跟主库的一样</p></blockquote><div class="language-conf line-numbers-mode" data-highlighter="shiki" data-ext="conf" data-title="conf" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>[mysqld]</span></span>
<span class="line"><span># 设置server_id，一般设置为IP,注意要唯一</span></span>
<span class="line"><span>server_id=101</span></span>
<span class="line"><span># 复制过滤：也就是指定数据库不用同步,多个之间用&#39;,&#39;号分割</span></span>
<span class="line"><span>binlog-ignore-db=mysql,information_schema,preformance_schema</span></span>
<span class="line"><span># 指定需要同步的二进制数据库</span></span>
<span class="line"><span>binlog-do-db=test</span></span>
<span class="line"><span># 开启二进制日志功能，以备Slave作为其它Slave的Master时使用</span></span>
<span class="line"><span>log-bin=edu-mysql-slave1-bin</span></span>
<span class="line"><span># 为每个session 分配的内存，在事务过程中用来存储二进制日志的缓存</span></span>
<span class="line"><span>binlog_cache_size=1M</span></span>
<span class="line"><span># 主从复制的格式（mixed,statement,row，默认格式是statement）</span></span>
<span class="line"><span>binlog_format=mixed</span></span>
<span class="line"><span># 二进制日志自动删除/过期的天数。默认值为0，表示不自动删除。</span></span>
<span class="line"><span>expire_logs_days=5</span></span>
<span class="line"><span># 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。</span></span>
<span class="line"><span># 如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致</span></span>
<span class="line"><span>slave_skip_errors=1062</span></span>
<span class="line"><span># relay_log配置中继日志</span></span>
<span class="line"><span>relay_log=edu-mysql-relay-bin</span></span>
<span class="line"><span># log_slave_updates表示slave将复制事件写进自己的二进制日志</span></span>
<span class="line"><span>log_slave_updates=1</span></span>
<span class="line"><span># 防止改变数据(除了特殊的线程)</span></span>
<span class="line"><span>read_only=1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>先查询主服务器当前二进制log文件</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">SHOW </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">MASTER</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> STATUS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>查询出来如下</li></ul><table><thead><tr><th>File</th><th>Position</th><th>Binlog_Do_DB</th><th>Binlog_Ignore_DB</th><th>Executed_Gtid_Set</th></tr></thead><tbody><tr><td>mysql-bin.000025</td><td>154</td><td>ichangg_im</td><td></td><td></td></tr></tbody></table><p><strong>进入从服务器MySQL执行以下命令</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">CHANGE </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">MASTER</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TO</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> MASTER_HOST</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;主服务器IP&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,MASTER_PORT</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3306</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,MASTER_USER</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;主服务器同步用户名&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,MASTER_PASSWORD</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;密码&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,MASTER_LOG_FILE</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;主MySQL二进制文件名&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,MASTER_LOG_POS</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">Position字段中数据,MASTER_CONNECT_RETRY</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">30</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><code>MASTER_HOST=&#39;192.168.1.100&#39;</code> #Master的IP地址</li><li><code>MASTER_USER=&#39;slave&#39;</code> #用于同步数据的用户（在Master中授权的用户）</li><li><code>MASTER_PASSWORD=&#39;123456&#39;</code> #同步数据用户的密码</li><li><code>MASTER_PORT=3306</code> #Master数据库服务的端口</li><li><code>MASTER_LOG_FILE=&#39;edu-mysql-bin.000001&#39;</code> #指定Slave从哪个日志文件开始读复制数据（Master上执行命令的结果的File字段）</li><li><code>MASTER_LOG_POS=429</code> #从哪个POSITION号开始读（Master上执行命令的结果的Position字段）</li><li><code>MASTER_CONNECT_RETRY=30</code> #当建立主从连接时，如果连接建立失败，间隔多久后重试。单位为秒，默认设置为60秒，同步延迟调优参数。</li></ul><p><strong>查看主从同步状态</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">show slave </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">status</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>开启复制</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">START</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> SLAVE;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="如果出现以下错误" tabindex="-1"><a class="header-anchor" href="#如果出现以下错误"><span>如果出现以下错误</span></a></h3><blockquote><p><code>ERROR 1872 (HY000): Slave failed to initialize relay log info structure from the repository</code></p></blockquote><blockquote><p>看样子是找不到中继日志的仓库，但是查看变量<code>relay log</code>的位置是设置了的</p></blockquote><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">show variables </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">like</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;relay%&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>重置复制信息</li></ul><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">RESET</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> MASTER</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>查看主从复制是否还有主从配置</li></ul><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">SHOW SLAVE </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">STATUS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">\\G</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>如果还有就执行以下命令清除所有</li></ul><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">RESET</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> SLAVE ALL;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>再次开启复制</li></ul><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">START</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> SLAVE;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>查看主从复制是否成功</li></ul><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">SHOW SLAVE </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">STATUS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">\\G</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>Operation CREATE USER failed</strong></p><blockquote><p><code>Error &#39;Operation CREATE USER failed for &#39;slave&#39;@&#39;%&#39;&#39; on query. Default database: &#39;&#39;. Query: </code></p><blockquote><p><code>&#39;CREATE USER &#39;slave&#39;@&#39;%&#39; IDENTIFIED WITH &#39;mysql_native_password&#39; AS &#39;*040A65A51A0B047A826CDE05448536015D471E15&#39;&#39;</code></p></blockquote></blockquote><ul><li>先执行以下命令</li></ul><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">STOP</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> SLAVE;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">FLUSH PRIVILEGES;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">START</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> SLAVE;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>如果错误仍然存在，执行以下命令</li></ul><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">STOP</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> SLAVE;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">DROP</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> USER</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;slave&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;%&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">START</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> SLAVE;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,99))])}const b=t(g,[["render",o],["__file","MySQL备份恢复.html.vue"]]),m=JSON.parse('{"path":"/DBS/MySQL%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D.html","title":"MySQL备份恢复","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"Flag","slug":"flag","link":"#flag","children":[]},{"level":2,"title":"binlog2sql","slug":"binlog2sql","link":"#binlog2sql","children":[{"level":3,"title":"MySQL必须设置参数","slug":"mysql必须设置参数","link":"#mysql必须设置参数","children":[]},{"level":3,"title":"user需要的最小权限集合","slug":"user需要的最小权限集合","link":"#user需要的最小权限集合","children":[]},{"level":3,"title":"查看目前的binlog文件","slug":"查看目前的binlog文件","link":"#查看目前的binlog文件","children":[]},{"level":3,"title":"定位误操作SQL的binlog位置","slug":"定位误操作sql的binlog位置","link":"#定位误操作sql的binlog位置","children":[]},{"level":3,"title":"生成sql文件回滚","slug":"生成sql文件回滚","link":"#生成sql文件回滚","children":[]},{"level":3,"title":"不生成sql文件回滚","slug":"不生成sql文件回滚","link":"#不生成sql文件回滚","children":[]}]},{"level":2,"title":"mysqldump","slug":"mysqldump","link":"#mysqldump","children":[{"level":3,"title":"mysqldump导出","slug":"mysqldump导出","link":"#mysqldump导出","children":[]},{"level":3,"title":"mysqldump导入","slug":"mysqldump导入","link":"#mysqldump导入","children":[]},{"level":3,"title":"mysqldump两台主机同步","slug":"mysqldump两台主机同步","link":"#mysqldump两台主机同步","children":[]}]},{"level":2,"title":"source命令导入","slug":"source命令导入","link":"#source命令导入","children":[]},{"level":2,"title":"主从同步","slug":"主从同步","link":"#主从同步","children":[{"level":3,"title":"配置主服务器","slug":"配置主服务器","link":"#配置主服务器","children":[]},{"level":3,"title":"配置从服务器","slug":"配置从服务器","link":"#配置从服务器","children":[]},{"level":3,"title":"如果出现以下错误","slug":"如果出现以下错误","link":"#如果出现以下错误","children":[]}]}],"git":{"createdTime":1726030162000,"updatedTime":1726030162000,"contributors":[{"name":"onni-top","email":"admin@onni.top","commits":1}]},"readingTime":{"minutes":10.09,"words":3028},"filePathRelative":"DBS/MySQL备份恢复.md","localizedDate":"2024年9月11日","excerpt":"\\n\\n<h2>Flag</h2>\\n<ul>\\n<li>热备份 <a href=\\"https://github.com/percona/percona-xtrabackup\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">https://github.com/percona/percona-xtrabackup</a></li>\\n<li><a href=\\"https://github.com/blylei/frabit\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">https://github.com/blylei/frabit</a></li>\\n</ul>"}');export{b as comp,m as data};
